# HTTP第一部分：web基础
1~4章

## 第一章
* web服务器返回文件时，会附加一个MIME类型。
	MIME是一种文本标记：
	text/html, image/jpeg, ...
* 隧道
通常用来在HTTP连接上转发非HTTP数据。

## 第二章
* URL中的片段
片段的处理在客户端进行，HTTP服务器只处理整个对象。（HTTP服务器返回整个对象，客户端只显示片段）
* 解析相对URL的算法 P36
* URL字符编码最适合的是根据方案判断不安全字符，编码所有不安全字符。
## 第三章
* 版本号不会被当成小数处理。版本中每个数字都会被当做一个**单独的数字**处理。比如，HTTP/2.22 比 HTTP/2.3 版本高，因为22>3。
* 长的首部行分为多行时，多出来的行前面至少要有一个空格或tab。
```
server : Test server
	Version 1.0
```
完整值为 "Test server	Version 1.0"
* PUT --存储数据
POST--发送数据，但不存储
对扩展方法宽容一些，不破坏端到端情况下，传递到下游。

## 第四章
* HTTPS 是在 HTTP 和 TCP 之间插入了一个SSL（密码加密层）
* HTTP 的性能很大程度上取决于 TCP的性能
* HTTP 的Connection 首部，逐跳首部，转发前删除。
* 串行连接
	** tips **：
		即使同时加载多幅图片比一次加载一个图片要慢，人们仍然会认为多幅图片加载更快一些。
		HTML设计应该在标签中显式地提供嵌入图片的宽高，消除“布局时延”。
* 并行连接（流水线）
	并行连接不一定更快，客户端带宽受限，服务器高负荷。浏览器一般会把并行连接数限制在一个较小值（如，4个）。
* 持久连接
	- keep-alive（默认关闭，1.0+版） && persistent（默认开启，1.1版）
	- 注意持久连接的数量，不宜过多。
	- keep-alive 选项：max 和 timeout
	- 持久连接
	```
	Content-Length首部对于持久连接是必不可少的(除非进行了分块编码)。如果报文通过持久连接传输，说明可能有另一条HTTP报文跟随其后。因为连接是持久的，两端都无法依赖连接关闭判断报文的结束。两端通过Content-Length才可以知道报文在何处结束，下一条报文从何处开始。如果Content-Length出错,HTTP应用程序就不知道目前传输的报文在哪里结束，下一条报文从哪里开始。
	```

	- 哑代理：客户端和服务器之间的不支持keep-alive的代理。服务器和客户端以为建立了持久连接，实际没有（代理处没有），直到超时关闭。
	- connection首部应该逐跳处理。
	- proxy-connection可以解决单层次代理（只有哑代理或聪明代理）的问题，但无法解决多层次代理（一条连接上既有哑代理又有聪明代理）的问题。
* 管道化连接（并发的/流水线式的 持久连接）
	- 出错时，客户端无法精确知道服务器处理了几条请求。
	- 非幂等请求不能用管道化方式传送。（幂等请求：多次请求执行结果相同）

* 关闭连接
	- 缓存代理遇到 实体长度与content-length 不符的情况，不应缓存这条响应，应原封不动转发。
	- close() 全关闭，shutdown() 半关闭
	- 关闭连接的输入通道比较危险，可能会清空你的输入缓存区（当有一个请求发送到已关闭的连接上时）
	- 关闭连接的输出信道总是安全的。
	- ** 应该先关闭输出信道，然后周期性检查输入信道的状态（查找数据或流的末尾）**